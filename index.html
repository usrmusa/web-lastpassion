<!DOCTYPE html>
<html lang="en">
<!-- 
    NOTICE: All source code, design, and assets are the property of Musa Mgijima and Digilayn Studio.
    Unauthorized copying, reproduction, or use of this code is strictly prohibited.
    Copyright Â© 2026. All Rights Reserved.
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Last Passion â€“ Official Store</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
    <link rel="shortcut icon" href="favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
    <link rel="manifest" href="favicon/site.webmanifest" />

    <!-- Developer Information -->
    <meta name="author" content="Musa Mgijima">
    <meta name="designer" content="Digilayn Studio">
    <meta name="contact" content="https://digilayn.co.za">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- External CSS -->
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Development Progress Banner */
        .dev-progress-banner {
            background: linear-gradient(90deg, #1a1a1a, #2d2d2d);
            color: #fff;
            padding: 10px 20px;
            text-align: center;
            font-size: 14px;
            border-bottom: 1px solid #444;
            position: relative;
            overflow: hidden;
        }
        .dev-progress-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            animation: loading-bar 2s infinite;
        }
        @keyframes loading-bar {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        .dev-badge {
            background: var(--primary);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            margin-right: 8px;
            text-transform: uppercase;
            vertical-align: middle;
        }
    </style>
</head>
<body>

<!-- Global Loader -->
<div id="global-loader">
    <div class="spinner"></div>
</div>

<!-- Development Progress Banner -->
<div class="dev-progress-banner">
    <span class="dev-badge">BETA</span>
    <span>We are still building great features! Watch this space as the web experience evolves. ðŸš€</span>
</div>

<nav>
    <div class="logo-nav">
        <img id="site-logo" src="img/lastpassion.jpg" alt="Last Passion">
    </div>

    <!-- Mobile Menu Toggle -->
    <div class="menu-toggle" onclick="toggleMenu()">
        <i class="fa-solid fa-bars"></i>
    </div>

    <div class="nav-links" id="navLinks">
        <a href="store/collections.html">Collections</a>
        <a href="company/support.html">Support</a>
        <div id="authLinks" style="display: flex; align-items: center;">
            <!-- Login link will be injected here by Firebase logic -->
        </div>
    </div>

    <div class="cart-icon" onclick="toggleCart()">
        <i class="fa-solid fa-bag-shopping"></i>
        <span class="cart-count">0</span>
    </div>
</nav>

<div class="hero">
    <img id="site-banner" src="img/lastpassion.jpg" alt="Banner">
</div>

<!-- Exclusive News Banner -->
<div class="news-banner">
    <div class="news-content">
        <span class="news-tag">EXCLUSIVE</span>
        <p><strong>Last Passion Winter Drop:</strong> Signature Hoodies now available. Limited stock only! <a href="store/collections.html?filter=winter" style="color: var(--primary); font-weight: 700;">Explore Now</a></p>
    </div>
</div>

<div class="products-container" id="product-grid">
    <!-- Products injected by script.js -->
</div>

<!-- Cart Sidebar -->
<div class="cart-sidebar" id="cartSidebar">
    <div class="cart-header">
        <h3>YOUR BAG</h3>
        <i class="fa-solid fa-xmark" style="cursor: pointer" onclick="toggleCart()"></i>
    </div>
    <div class="cart-items" id="cartItems">
        <!-- Items go here -->
    </div>
    <div class="cart-footer">
        <div class="total-row">
            <span>Total</span>
            <span id="cartTotal">R 0.00</span>
        </div>
        <button class="btn-checkout" onclick="openCheckout()">Checkout</button>
    </div>
</div>

<!-- Checkout Modal -->
<div class="modal" id="checkoutModal">
    <div class="modal-content">
        <h2 style="font-family: 'Bebas Neue'">Checkout</h2>
        <p style="margin-bottom: 20px; color: var(--on-surface-variant);">Complete your order details below.</p>
        <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="custName" placeholder="Your name will appear here" readonly>
        </div>
        <div class="form-group">
            <label>Payment Method</label>
            <div style="background: var(--surface-variant); padding: 15px; border-radius: 8px; font-size: 14px; color: var(--on-surface-variant); border: 1px dashed var(--outline);">
                <p>ðŸ’¬ <strong>WhatsApp Manual Payment Link</strong></p>
                <p style="margin-top: 10px; font-size: 12px; opacity: 0.8;">ðŸ’³ Instant EFT & Card payments are coming soon!</p>
            </div>
        </div>
        <button class="btn-checkout" style="background: var(--success-green); color: white;" onclick="processOrder()">
            Place Order via WhatsApp
        </button>
        <button class="btn-checkout" style="background: var(--surface-variant); color: var(--on-surface-variant); margin-top: 10px;" onclick="closeCheckout()">Cancel</button>
    </div>
</div>

<footer>
    <p>&copy; 2026 Last Passion Clothing. All Rights Reserved.</p>
    <a href="https://digilayn.com" style="color: var(--brand-green); font-size: 10px; text-decoration: none; margin-top: 20px; display: block; font-weight: bold;">DIGILAYN STUDIO</a>
</footer>

<!-- Firebase SSOT -->
<script type="module">
  import { auth, db, COLLECTIONS } from './core/FirebaseService.js';
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

  // Initial UI Setup: Fetch Logo and Banner from SSOT
  async function loadSiteBranding() {
    try {
      const brandingDoc = await getDoc(doc(db, COLLECTIONS.PRODUCTS, 'main'));
      if (brandingDoc.exists()) {
        const data = brandingDoc.data();
        if (data.logoUrl) document.getElementById('site-logo').src = data.logoUrl;
        if (data.bannerUrl) document.getElementById('site-banner').src = data.bannerUrl;
      }
    } catch (e) {
      console.error("Error loading branding:", e);
    }
  }
  loadSiteBranding();

  // Auth State Listener
  const authLinks = document.getElementById('authLinks');
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      // 1. Initial name from Auth profile - Show immediately
      let name = user.displayName || user.email.split('@')[0];
      authLinks.innerHTML = `<a href="authentication/profile.html" class="nav-user-link">Hi, ${name}</a>`;

      // Hide loader as soon as basic auth is determined
      document.getElementById('global-loader').classList.add('hidden');

      // 2. Background fetch for the most up-to-date Full Name
      try {
        const userDoc = await getDoc(doc(db, COLLECTIONS.USERS, user.uid));
        if (userDoc.exists()) {
          const data = userDoc.data();
          if (data.displayName) {
             authLinks.innerHTML = `<a href="authentication/profile.html" class="nav-user-link">Hi, ${data.displayName}</a>`;
          }
        }
      } catch (e) {
        console.error("Error updating display name:", e);
      }
    } else {
      const currentPath = window.location.pathname.split('/').pop() || 'index.html';
      authLinks.innerHTML = `<a href="authentication/login.html?returnUrl=../${currentPath}">Login</a>`;
      // Hide loader for guest
      document.getElementById('global-loader').classList.add('hidden');
    }
  });

  // Make Firebase accessible to script.js
  window.auth = auth;
  window.db = db;
</script>

<!-- External JS -->
<script src="script.js"></script>
</body>
</html>
